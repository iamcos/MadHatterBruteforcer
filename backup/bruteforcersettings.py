
configs=[['27', '2', '2', '8', 'False', 'False', 'False', '17', '42', '72', '6', '81', '12'], ['21', '2', '2', '0', 'False', 'False', 'False', '34', '12', '71', '500', '100', '16'], ['7', '2', '2', '6', 'False', 'False', 'False', '18', '40', '51', '7', '23', '18'], ['71', '1', '1', 'D1', 'False', 'False', 'False', '46', '46', '69', '12', '61', '10'], ['23', '1', '1', '7', 'False', 'False', 'False', '33', '40', '56', '12', '26', '2'], ['5', '2', '2', '7', 'False', 'False', 'False', '9', '37', '70', '12', '24', '9'], ['25', '1', '1', '0', 'False', 'False', 'False', '19', '31', '62', '10', '398', '116'], ['18', '2.5', '1', '8', 'True', 'False', 'False', '4', '41', '70', '24', '52', '12'], ['21', '2.9', '1', '7', 'False', 'False', 'False', '2', '31', '80', '20', '40', '2'], ['21', '1', '1', '1', 'False', 'False', 'False', '12', '27', '69', '20', '120', '12'], ['15', '2.4', '1.1', '0', 'False', 'True', 'False', '7', '32', '75', '12', '24', '11'], ['20', '1', '1', '6', 'False', 'False', 'False', '4', '31', '61', '20', '40', '2'], ['33', '1', '1.3', '6', 'False', 'False', 'False', '26', '31', '54', '6', '81', '2'], ['34', '1.8', '1.5', '2', 'False', 'False', 'False', '24', '40', '64', '50', '100', '21'], ['19', '2.5', '0.9', '8', 'True', 'False', 'False', '5', '40', '81', '24', '52', '11'], ['10', '2.05', '0.3', '0', 'False', 'False', 'False', '5', '21', '81', '20', '120', '4'], ['18', '2', '1', '8', 'False', 'False', 'True', '4', '41', '81', '120', '12', '2'], ['35', '0.93', '1.57', 'D1', 'False', 'False', 'False', '16', '46', '69', '53', '41', '38'], ['25', '2.4', '1.6', '0', 'False', 'False', 'False', '12', '31', '69', '12', '30', '8'], ['7', '1.2', '1.3', '7', 'False', 'False', 'False', '6', '25', '81', '40', '159', '2'], ['22', '2.2', '2.1', '6', 'False', 'False', 'False', '18', '44', '61', '50', '100', '11'], ['18', '1.4', '1.9', '0', 'False', 'False', 'False', '3', '25', '55', '16', '23', '1'], ['21', '2.6', '2.2', '1', 'False', 'False', 'False', '9', '21', '81', '3', '8', '12'], ['21', '1', '1.1', '0', 'False', 'False', 'False', '30', '42', '61', '20', '40', '2'], ['2', '1', '1', '5', 'False', 'False', 'False', '5', '31', '71', '20', '40', '12'], ['3', '1', '1', 'T1', 'False', 'False', 'False', '21', '33', '69', '20', '100', '2'], ['19', '1.1', '1.5', '2', 'False', 'False', 'False', '8', '35', '73', '20', '40', '11'], ['10', '2', '1', '0', 'False', 'False', 'False', '9', '31', '79', '20', '80', '2'], ['17', '2', '2', '5', 'False', 'False', 'False', '8', '34', '64', '50', '120', '12'], ['21', '2.5', '1.5', '0', 'True', 'False', 'False', '6', '31', '77', '12', '26', '10'], ['56', '1.8', '1.8', '7', 'False', 'False', 'False', '61', '35', '63', '12', '117', '12'], ['21', '2.5', '1.172', '0', 'True', 'False', 'True', '6', '34', '76', '2', '40', '2'], ['12', '1', '1', '7', 'False', 'False', 'False', '15', '36', '62', '5', '55', '2'], ['3', '1.3', '0.5', '8', 'False', 'False', 'False', '5', '32', '67', '33', '66', '9'], ['10', '1.5', '1', '7', 'False', 'False', 'False', '10', '32', '77', '12', '26', '9'], ['21', '1', '1', '7', 'False', 'False', 'True', '21', '43', '56', '30', '60', '3'], ['10', '2', '2', '5', 'False', 'False', 'False', '2', '41', '55', '20', '40', '122'], ['20', '1', '1', '0', 'False', 'False', 'False', '4', '41', '71', '7', '23', '18'], ['7', '2.4', '1.57', '0', 'False', 'False', 'False', '6', '32', '77', '12', '26', '9'], ['51', '21', '1', '0', 'False', 'False', 'False', '2', '41', '51', '20', '40', '2'], ['53', '1.1', '0.9', 'D1', 'False', 'False', 'False', '14', '41', '71', '22', '24', '2'], ['45', '1', '1', '7', 'False', 'False', 'False', '9', '49', '81', '10', '52', '2'], ['12', '1', '1', '7', 'True', 'True', 'False', '21', '41', '65', '12', '26', '12'], ['21', '1', '1', '0', 'False', 'False', 'False', '40', '48', '51', '12', '24', '8'], ['30', '2', '1.3', '0', 'True', 'False', 'False', '4', '45', '78', '20', '80', '2'], ['2', '2', '2', '8', 'False', 'False', 'False', '10', '31', '64', '4', '8', '2'], ['18', '2.5', '1', '8', 'True', 'False', 'False', '3', '11', '65', '55', '180', '16'], ['19', '1.3', '1.8', '0', 'False', 'False', 'False', '18', '35', '61', '7', '23', '18'], ['65', '2.719', '2', '8', 'True', 'False', 'False', '5', '41', '78', '24', '52', '12'], ['14', '2', '2', '1', 'False', 'False', 'False', '6', '25', '66', '7', '49', '2'], ['53', '1.1', '0.92', 'D1', 'False', 'False', 'False', '12', '43', '71', '22', '26', '2'], ['20', '2.7', '2', '2', 'True', 'False', 'False', '5', '25', '77', '5', '10', '2'], ['29', '2.18', '2.79', '2', 'False', 'False', 'False', '41', '38', '70', '17', '41', '44'], ['26', '3.1', '2.06', 'D1', 'False', 'False', 'False', '15', '26', '58', '27', '56', '5'], ['20', '1.59', '0.77', '2', 'False', 'False', 'False', '6', '38', '81', '54', '56', '10'], ['31', '0.7', '0.7', '8', 'False', 'False', 'False', '7', '37', '67', '44', '81', '8'], ['41', '2', '1', '0', 'False', 'False', 'False', '10', '31', '64', '4', '8', '2']]

def backtestingfrommemory():
	settingsprev = []
	settingsstats = []
	print('Downloading backtsting history... Expect results anytime soon')
	interval = setbotbtinterval()
	#userinput = input('Please chose backtesting mechanism: 1 - all settings, 2 - every second, 3 - every third. Last - fastest')
	for i, v in enumerate(configs):

		bot = configuremh(currentBotGuid,configs[i][0], configs[i][1], configs[i][2], configs[i][3], configs[i][4], configs[i][5],configs[i][6], configs[i][7], configs[i][8], configs[i][9], configs[i][10], configs[i][11], configs[i][12])
		configuremhsafety(currentBotGuid, 0, 0, 0)
		backtest = haasomeClient.customBotApi.backtest_custom_bot_on_market(accountGuid, currentBotGuid, interval, primarycurrency, secondarycurrency, contractname).result
		roi = backtest.roi
		prevroi = roi
		settings = configs[i][0], configs[i][1], configs[i][2], configs[i][3], configs[i][4], configs[i][5],configs[i][6], configs[i][7], configs[i][8], configs[i][9], configs[i][10], configs[i][11], configs[i][12]
		configroi.append([configs[i][0], configs[i][1], configs[i][2], configs[i][3], configs[i][4], configs[i][5],	configs[i][6], configs[i][7], configs[i][8], configs[i][9], configs[i][10], configs[i][11], configs[i][12], roi])
		settingsprev = settings
		print('ROI:', roi, 'Bot configuration :', configs[i][0], configs[i][1], configs[i][2], configs[i][3], configs[i][4], configs[i][5],configs[i][6], configs[i][7], configs[i][8], configs[i][9], configs[i][10], configs[i][11], configs[i][12])
		btresults[roi] = settings
		botconfig = haasomeClient.customBotApi.get_custom_bot(currentBotGuid, EnumCustomBotType.MAD_HATTER_BOT).result
		botorders = botconfig.completedOrders
	with open('btresults.csv', 'w', newline='') as csvfile:
		fieldnames = ['price','ammountFilled', 'unixAddedTime']
		csvwriter = csv.DictWriter(csvfile,fieldnames=fieldnames)
		csvwriter.writeheader()
		for i, v in enumerate(botorders):
			csvwriter.writerow({'price': v.price, 'ammountFilled':v.amountFilled,'unixAddedTime':v.unixAddedTime})
	filename = primarycurrency+'/'+secondarycurrency
	with open('botconfigs.csv', 'w', newline='') as csvfile:
		fieldnames = ['n', 'bbLength', 'bbDevUp', 'bbDevDown', 'bbMAType', 'fcc', 'rm', 'mms', 'RSILength', 'RSIBuy', 'RSISell', 'MACDSlow', 'MACDFast', 'MACDSignal', 'roi']
		csvwriter = csv.DictWriter(csvfile,fieldnames=fieldnames)
		csvwriter.writeheader()
		for i, v in enumerate(configroi):
			csvwriter.writerow({'n': i ,'bbLength':configroi[i][0], 'bbDevUp':configroi[i][1], 'bbDevDown':configroi[i][2],'bbMAType':configroi[i][3], 'fcc':configroi[i][4], 'rm':configroi[i][5], 'mms':configroi[i][6], 'RSILength':configroi[i][7], 'RSIBuy':configroi[i][8],'RSISell':configroi[i][9], 'MACDSlow':configroi[i][10],'MACDFast':configroi[i][11], 'MACDSignal':configroi[i][12], 'roi':roi})

	configroiorted = sorted(configroi, key=lambda x: x[13], reverse=False)
	return configroiorted

def createbotsfrombtresults():
	currentBotGuid = ''
	for i,v in enumerate(configroiorted):
		print(i, 'ROI: ', v[13])
	botstocreate = int(input('Type number of how any bots yo would like to create?'))
	for bots in range(0,botstocreate):
		
		i = int(input('Type bot number to create'))
		botname = str(primarycurrency) + str(' / ') + \
		str(secondarycurrency) + str(' Roi ') + str(configroiorted[i][13])
		newbot = haasomeClient.customBotApi.new_custom_bot(accountGuid, botType, botname, primarycurrency, secondarycurrency, contractname).result
		print('newbot guuid', newbot.guid)
		currentBotGuid = newbot.guid
		setup_newbot = configuremh(currentBotGuid,configroiorted[i][0], configroiorted[i][1], configroiorted[i][2], configroiorted[i][3], configroiorted[i][4], configroiorted[i][5], configroiorted[i][6], configroiorted[i][7], configroiorted[i][8], configroiorted[i][9], configroiorted[i][10], configroiorted[i][11], configroiorted[i][12])
		configuremhsafety(currentBotGuid, 0, 0, 0)
		print(botname, 'has been created')

def doallpairs():
	
	interval = setbotbtinterval()
	pairslist = []
	# contractnamelist = []
	results = list()
	for i,v  in enumerate(allpairs):
		pairslist.append([v.secondaryCurrency, v.contractName, v.tradeFee, v.minimumTradeAmount])
		#safeHistoryGet(MarketEnum, v.primaryCurrency, v.secondaryCurrency, v.contractName, 4, interval)
		backtest = haasomeClient.customBotApi.backtest_custom_bot_on_market(
					accountGuid, currentBotGuid, interval, v.primaryCurrency, v.secondaryCurrency, v.contractName).result
		roi = backtest.roi
		results.append([roi, pairslist])
		print(roi, v.primaryCurrency, v.secondaryCurrency)
	
	# resultssorted = sorted(results, key=lambda x: x[0], reverse=False)
	
		str(secondarycurrency)